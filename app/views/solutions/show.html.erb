<div class="wrapper-pages">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><%= link_to @solution.problem.title.first(10), problem_path(@solution.problem) %>...</li>
        <li class="breadcrumb-item active" aria-current="page"><%= @solution.title.first(7) %>...</li>
      </ol>
    </nav>

    <h3><%= @solution.title %></h3>

    <div>
      <%= render "solutions/showcard" %>
    </div>
    
    <div class="display-flex m-3">
    
    
      <h6>COLLABORATORS</h6>
      <% if @solution.collaborators.exists? %>
        <% @solution.collaborators.each do |collaborator|%> 
          <% if collaborator.photo.attached? %>
            <p><%= cl_image_tag collaborator.photo.key, height: 24, width: 24, crop: :fill, gravity: :face %> <%= collaborator.first_name %> <%= collaborator.last_name  %></p>
          <% else %>
              <p><span><img src="https://res.cloudinary.com/docykmjwf/image/upload/c_scale,h_24/v1600307295/default_profile_pic_ypyuhz.png" alt="user-avatar" style="crop:fill"> <%= collaborator.first_name %> <%= collaborator.last_name %></span></p>
          <% end %>

          <% collaboration = Collaboration.where(user: collaborator, solution: @solution).take %>
          <% if current_user === @solution.user && collaboration.status === "Pending" %>
            <%= link_to icon('fas', 'check'), collab_status_solution_path(collaboration, status: "Accepted"), method: "patch" %>
            <%= link_to icon('fas', 'times'), collab_status_solution_path(collaboration, status: "Rejected"), method: "patch" %>
          <% else %>
            <%= collaboration.status %>
          <% end %>
        <% end %>
      <% else %>
        <i>Raise your hand to be the first collaborator!</i>
      <% end %>
    </div>
    

    <div class="pitch-section">
      <div class="row px-3 align-items-center justify-content-between">
        <h4 class="my-3">Pitches</h4>
        <div class="my-3">
          <%= link_to 'Submit a pitch', new_problem_solution_pitch_path(@solution.problem, @solution), class: 'small-btn' %>
        </div>
      </div>
      <div class="d-inline-flex justify-content-around">
        <% if @solution.pitches.exists? %>
          <% @pitches.each do |pitch| %>
            <h5><%= link_to pitch.title, pitch_path(pitch) %></h5>

            <div class="actions">
              <% if Vote.where(votable: pitch, user:  current_user).empty? %>
                <%= link_to upvote_problem_path(pitch), method: :post, class: 'button'  do %>
                  <i class="far fa-thumbs-up"></i>
                <% end %>
              <% else %>
                <i class="fas fa-thumbs-up"></i>
              <% end %>
              <span><%= pitch.votes.count %></span>
            </div>
          <% end %>
          <br>
        <% else %>
          <i>When all you husslrs are ready, submit a link to your pitch deck!</i>
        <% end %>
      </div>
    </div>

    <h4 class="my-3">Comments</h4>
    <div class="comments-container">
      <% @solution.comments.each do |comment| %>
        <div class="comment">
          <p id='username'><%= comment.user.first_name %> <span><%= comment.user.last_name %></span></p>
          <p><%= comment.content %></p>
        </div>
      <% end %>
    </div>

    <div class="new-comment-bar">
      <div class="new-comment">
        <%= simple_form_for ([@problem, @solution, @comment]), remote: true do |f| %>
            <%= f.input :content, placeholder: "Type your comment here..." %>
            <%= f.button :button, wrapper_html: { id: 'button' } do %>
              <i class="far fa-paper-plane"></i>
            <% end %>
        <% end %>
      </div>
    </div>

  </div>
</div>
